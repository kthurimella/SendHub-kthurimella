#!usr/bin/env python
import random
import sys
import subprocess

def main():

    f = open('input.txt', 'w')
    f.write("{\n")
    f.write('"message": "'+ sys.argv[2]+'",\n')
    f.write('"recipients": [')
    
    phone_total = int(sys.argv[1])

    for x in range(phone_total):
        if x == phone_total - 1:
            f.write('"'+str(random.randint(1000000000, 9999999999)) +'"]\n')
        else:
            f.write('"'+str(random.randint(1000000000, 9999999999)) +'",')

    f.write('}')

    curl('-i', '-F', 'input=@input.txt', 'http://sendhub-kthurimella.herokuapp.com')

def curl(*args):
    curl_path = '/usr/bin/curl'
    curl_list = [curl_path]
    for arg in args:
        curl_list.append(arg)
    curl_result = subprocess.Popen(
                 curl_list,
                 stderr=subprocess.PIPE,
                 stdout=subprocess.PIPE).communicate()[0]
    print curl_result
    return curl_result 



if __name__ == "__main__":
    main()
